{% extends 'base.html' %}
{% load humanize %}

{% block content-header %}
<div class="card-header">
  <div class="card-tools">
    <a href="#" class="btn btn-tool">Imprimer</a>
    <a href="{% url 'canteen-invoice-update' object.id %}" class="btn btn-tool">
      <i class="fas fa-edit"></i>
    </a>
    <a href="{% url 'canteen-invoice-delete' object.id %}" class="btn btn-tool">
      <i class="fas fa-times"></i>
    </a>
  </div>
</div>
{% endblock content-header %}

{% block content %}

<div class="row">
  <div class="col-sm-4">
    <h3>{{ object.student }}</h3>
    <h5>{{ object.session }}</h5>
    <h5>{{ object.datecreation }}</h5>
    <h6>
      Status :
      {% if object.status == 'paid' %}
        <span class="badge badge-success">Payé</span>
      {% elif object.status == 'partial' %}
        <span class="badge badge-warning">Partiel</span>
      {% else %}
        <span class="badge badge-danger">Impayé</span>
      {% endif %}
    </h6>
    <hr>
    <div>
      <h4>Solde attendu : {{ object.balance|intcomma }}</h4>
    </div>
  </div>

  <div class="col-sm-8">
    <table class="table table-sm table-bordered">
      Détail de la facture cantine
      <thead class="thead-light">
        <tr>
          <th>S/N</th>
          <th>Description</th>
          <th>Montant</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>Frais de cantine</td>
          <td>{{ object.total_amount|intcomma }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td></td>
          <td>Montant total à payer</td>
          <td>{{ object.total_amount|intcomma }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Montant total payé</td>
          <td>{{ object.total_paid|intcomma }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Solde</td>
          <td>{{ object.balance|intcomma }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<hr>

<h5>Historique des paiements</h5>
<table class="table table-bordered table-sm">
  <thead class="thead-light">
    <tr>
      <th>S/N</th>
      <th>Montant payé</th>
      <th>Date de paiement</th>
      <th>Commentaire</th>
    </tr>
  </thead>
  <tbody>
    {% for payment in payments %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ payment.amount_paid|intcomma }}</td>
      <td>{{ payment.date_paid }}</td>
      <td>{{ payment.comment }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-center">Aucun paiement enregistré</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock content %}
